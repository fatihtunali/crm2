openapi: 3.0.3
info:
  title: CRM System API
  description: |
    Complete API documentation for the Tour Operator CRM system.

    This API provides endpoints for managing:
    - Suppliers (Hotels, Guides, Vehicles, Tour Packages, Restaurants, Transfers, Extra Expenses, Entrance Fees)
    - Quotations and Itineraries
    - Customer Requests
    - Invoices (Receivable & Payable)
    - Finance and Business Metrics
    - Providers/Companies
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://your-production-domain.com
    description: Production server

tags:
  - name: Suppliers
    description: Manage all supplier types (hotels, guides, vehicles, etc.)
  - name: Quotations
    description: Create and manage travel quotations
  - name: Invoices
    description: Handle receivable and payable invoices
  - name: Finance
    description: Financial reports and metrics
  - name: Dashboard
    description: Dashboard statistics and metrics
  - name: Providers
    description: Manage provider/company information

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message

    Provider:
      type: object
      properties:
        id:
          type: integer
          format: int64
        provider_name:
          type: string
        provider_type:
          type: string
        contact_email:
          type: string
          format: email
        contact_phone:
          type: string
        status:
          type: string
          enum: [active, inactive]

    Hotel:
      type: object
      properties:
        id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        hotel_name:
          type: string
        city:
          type: string
        google_place_id:
          type: string
        rating:
          type: number
          format: float
        status:
          type: string
          enum: [active, inactive]

    Guide:
      type: object
      properties:
        id:
          type: integer
          format: int64
        organization_id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        city:
          type: string
        language:
          type: string
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [active, inactive]

    Vehicle:
      type: object
      properties:
        id:
          type: integer
          format: int64
        organization_id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        vehicle_type:
          type: string
        max_capacity:
          type: integer
        city:
          type: string
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [active, inactive]

    TourPackage:
      type: object
      properties:
        id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        tour_name:
          type: string
        tour_code:
          type: string
        city:
          type: string
        duration_days:
          type: integer
        tour_type:
          type: string
        status:
          type: string
          enum: [active, inactive]

    Restaurant:
      type: object
      properties:
        id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        restaurant_name:
          type: string
        city:
          type: string
        cuisine_type:
          type: string
        status:
          type: string
          enum: [active, inactive]

    Transfer:
      type: object
      properties:
        id:
          type: integer
          format: int64
        organization_id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        vehicle_id:
          type: integer
          format: int64
        from_city:
          type: string
        to_city:
          type: string
        season_name:
          type: string
        price_oneway:
          type: number
          format: decimal
        price_roundtrip:
          type: number
          format: decimal
        status:
          type: string
          enum: [active, inactive]

    ExtraExpense:
      type: object
      properties:
        id:
          type: integer
          format: int64
        organization_id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        expense_name:
          type: string
        expense_category:
          type: string
        city:
          type: string
        currency:
          type: string
        unit_price:
          type: number
          format: decimal
        unit_type:
          type: string
        status:
          type: string
          enum: [active, inactive]

    EntranceFee:
      type: object
      properties:
        id:
          type: integer
          format: int64
        provider_id:
          type: integer
          format: int64
          nullable: true
        provider_name:
          type: string
          nullable: true
        site_name:
          type: string
        city:
          type: string
        google_place_id:
          type: string
        rating:
          type: number
          format: float
        status:
          type: string
          enum: [active, inactive]

    Quotation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        request_id:
          type: integer
          format: int64
        customer_name:
          type: string
        customer_email:
          type: string
          format: email
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        total_price:
          type: number
          format: decimal
        currency:
          type: string
        status:
          type: string
          enum: [draft, sent, accepted, rejected]

    Invoice:
      type: object
      properties:
        id:
          type: integer
          format: int64
        quotation_id:
          type: integer
          format: int64
        invoice_type:
          type: string
          enum: [receivable, payable]
        invoice_number:
          type: string
        amount:
          type: number
          format: decimal
        currency:
          type: string
        status:
          type: string
          enum: [pending, paid, overdue, cancelled]
        due_date:
          type: string
          format: date
        paid_date:
          type: string
          format: date
          nullable: true

paths:
  /api/providers:
    get:
      tags:
        - Providers
      summary: Get all active providers
      description: Retrieve list of all active providers/companies
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Provider'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/hotels:
    get:
      tags:
        - Suppliers
      summary: Get all hotels
      description: Retrieve hotels with optional filtering
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [all, active, inactive]
        - name: city
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Hotel'
    post:
      tags:
        - Suppliers
      summary: Create new hotel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - hotel_name
                - city
              properties:
                hotel_name:
                  type: string
                city:
                  type: string
                google_place_id:
                  type: string
                rating:
                  type: number
      responses:
        '200':
          description: Hotel created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  id:
                    type: integer
    put:
      tags:
        - Suppliers
      summary: Update hotel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                provider_id:
                  type: integer
                  nullable: true
                hotel_name:
                  type: string
                city:
                  type: string
                status:
                  type: string
      responses:
        '200':
          description: Hotel updated successfully
    delete:
      tags:
        - Suppliers
      summary: Archive hotel (soft delete)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
      responses:
        '200':
          description: Hotel archived successfully

  /api/guides:
    get:
      tags:
        - Suppliers
      summary: Get all guides
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
        - name: language
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Guide'
    post:
      tags:
        - Suppliers
      summary: Create new guide
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Guide'
      responses:
        '200':
          description: Guide created successfully
    put:
      tags:
        - Suppliers
      summary: Update guide
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Guide'
      responses:
        '200':
          description: Guide updated successfully
    delete:
      tags:
        - Suppliers
      summary: Archive guide
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
      responses:
        '200':
          description: Guide archived successfully

  /api/vehicles:
    get:
      tags:
        - Suppliers
      summary: Get all vehicles
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Vehicle'
    post:
      tags:
        - Suppliers
      summary: Create new vehicle
      responses:
        '200':
          description: Vehicle created successfully
    put:
      tags:
        - Suppliers
      summary: Update vehicle
      responses:
        '200':
          description: Vehicle updated successfully
    delete:
      tags:
        - Suppliers
      summary: Archive vehicle
      responses:
        '200':
          description: Vehicle archived successfully

  /api/tour-packages:
    get:
      tags:
        - Suppliers
      summary: Get all tour packages
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: tour_type
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TourPackage'
    post:
      tags:
        - Suppliers
      summary: Create new tour package
      responses:
        '200':
          description: Tour package created
    put:
      tags:
        - Suppliers
      summary: Update tour package
      responses:
        '200':
          description: Tour package updated
    delete:
      tags:
        - Suppliers
      summary: Archive tour package
      responses:
        '200':
          description: Tour package archived

  /api/restaurants:
    get:
      tags:
        - Suppliers
      summary: Get all restaurants
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
        - name: cuisine_type
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Restaurant'
    post:
      tags:
        - Suppliers
      summary: Create new restaurant
      responses:
        '200':
          description: Restaurant created
    put:
      tags:
        - Suppliers
      summary: Update restaurant
      responses:
        '200':
          description: Restaurant updated
    delete:
      tags:
        - Suppliers
      summary: Archive restaurant
      responses:
        '200':
          description: Restaurant archived

  /api/transfers:
    get:
      tags:
        - Suppliers
      summary: Get all intercity transfers
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: from_city
          in: query
          schema:
            type: string
        - name: to_city
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transfer'
    post:
      tags:
        - Suppliers
      summary: Create new transfer
      responses:
        '200':
          description: Transfer created
    put:
      tags:
        - Suppliers
      summary: Update transfer
      responses:
        '200':
          description: Transfer updated
    delete:
      tags:
        - Suppliers
      summary: Archive transfer
      responses:
        '200':
          description: Transfer archived

  /api/extra-expenses:
    get:
      tags:
        - Suppliers
      summary: Get all extra expenses
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: expense_category
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExtraExpense'
    post:
      tags:
        - Suppliers
      summary: Create new extra expense
      responses:
        '200':
          description: Extra expense created
    put:
      tags:
        - Suppliers
      summary: Update extra expense
      responses:
        '200':
          description: Extra expense updated
    delete:
      tags:
        - Suppliers
      summary: Archive extra expense
      responses:
        '200':
          description: Extra expense archived

  /api/entrance-fees:
    get:
      tags:
        - Suppliers
      summary: Get all entrance fees
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EntranceFee'
    post:
      tags:
        - Suppliers
      summary: Create new entrance fee
      responses:
        '200':
          description: Entrance fee created
    put:
      tags:
        - Suppliers
      summary: Update entrance fee
      responses:
        '200':
          description: Entrance fee updated
    delete:
      tags:
        - Suppliers
      summary: Archive entrance fee
      responses:
        '200':
          description: Entrance fee archived

  /api/quotations:
    get:
      tags:
        - Quotations
      summary: Get all quotations
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [all, draft, sent, accepted, rejected]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quotation'
    post:
      tags:
        - Quotations
      summary: Create new quotation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                request_id:
                  type: integer
                customer_name:
                  type: string
                customer_email:
                  type: string
                start_date:
                  type: string
                  format: date
                end_date:
                  type: string
                  format: date
      responses:
        '200':
          description: Quotation created successfully

  /api/quotations/{id}:
    get:
      tags:
        - Quotations
      summary: Get quotation by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quotation'
    put:
      tags:
        - Quotations
      summary: Update quotation
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Quotation updated

  /api/quotations/{id}/generate-itinerary:
    post:
      tags:
        - Quotations
      summary: Generate AI itinerary for quotation
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Itinerary generated successfully

  /api/quotations/{id}/status:
    put:
      tags:
        - Quotations
      summary: Update quotation status
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [draft, sent, accepted, rejected]
      responses:
        '200':
          description: Status updated successfully

  /api/invoices/receivable:
    get:
      tags:
        - Invoices
      summary: Get all receivable invoices
      parameters:
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Invoice'

  /api/invoices/receivable/{id}:
    get:
      tags:
        - Invoices
      summary: Get receivable invoice by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Successful response

  /api/invoices/receivable/{id}/payment:
    put:
      tags:
        - Invoices
      summary: Record payment for receivable invoice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paid_amount:
                  type: number
                paid_date:
                  type: string
                  format: date
      responses:
        '200':
          description: Payment recorded successfully

  /api/invoices/payable:
    get:
      tags:
        - Invoices
      summary: Get all payable invoices
      parameters:
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response

  /api/invoices/payable/{id}:
    get:
      tags:
        - Invoices
      summary: Get payable invoice by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Successful response

  /api/invoices/payable/{id}/payment:
    put:
      tags:
        - Invoices
      summary: Record payment for payable invoice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Payment recorded

  /api/invoices/generate:
    post:
      tags:
        - Invoices
      summary: Generate invoices for quotation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                quotation_id:
                  type: integer
      responses:
        '200':
          description: Invoices generated successfully

  /api/finance/summary:
    get:
      tags:
        - Finance
      summary: Get financial summary
      description: Revenue, expenses, and profit metrics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_revenue:
                    type: number
                  total_expenses:
                    type: number
                  net_profit:
                    type: number
                  currency:
                    type: string

  /api/finance/customers:
    get:
      tags:
        - Finance
      summary: Get customer financial data
      responses:
        '200':
          description: Successful response

  /api/finance/suppliers:
    get:
      tags:
        - Finance
      summary: Get supplier financial data
      responses:
        '200':
          description: Successful response

  /api/dashboard/stats:
    get:
      tags:
        - Dashboard
      summary: Get dashboard statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_quotations:
                    type: integer
                  total_bookings:
                    type: integer
                  pending_requests:
                    type: integer

  /api/dashboard/recent-requests:
    get:
      tags:
        - Dashboard
      summary: Get recent customer requests
      responses:
        '200':
          description: Successful response

  /api/dashboard/upcoming-tours:
    get:
      tags:
        - Dashboard
      summary: Get upcoming tours
      responses:
        '200':
          description: Successful response

  /api/suppliers/search:
    get:
      tags:
        - Suppliers
      summary: Search across all supplier types
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
